<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <title>Winter Windings</title>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css' rel='stylesheet' integrity='sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN' crossorigin='anonymous'>

  <style>
    body {
      height: 100%;
      user-select: none;
      overflow: hidden;
    }

    #subheader {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #word-grid {
      display: grid;
      grid-gap: 8px;
    }

    #word-grid .grid-cell {
      text-transform: uppercase;
      border-radius: 6px;
      background-color: #fff;
      min-height: 70px;
      display: grid;
      align-items: center;
      justify-items: center;
      cursor: pointer;
      transition: all 0.1s linear;
    }

    .button-toolbar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .button {
      background-color: #fff;
      border: black solid 1px;
      border-radius: 1.5em;
      height: 3em;
      font-weight: 600;
      width: fit-content;
      display: flex;
      text-align: center;
      justify-content: center;
      align-items: center;
      padding: 15px;
      cursor: pointer;
    }

    .button.down {
      background-color: #e2e2e2;
    }

    .button.submit {
      color: #7f7f7f;
      border-color: #7f7f7f;
    }

    .button.submit.active {
      color: #fff;
      background-color: #000;
    }

  </style>
</head>

<body>

<div class='container p-2' style='position: relative;'>
  <h3 class='display-5'>Winter Windings 2024</h3>  
  <div id='subheader'>
    <small class='text-muted'>From the Peck-Borland family</small>
    <div class='btn-toolbar'>
      <button id='info-button' type='button' data-toggle='dropdown' style='background-color: rgba(0, 0, 0, 0); border: none;'>  
        <svg xmlns='http://www.w3.org/2000/svg' width='20' height='20' fill='currentColor' class='bi bi-info-circle' viewBox='0 0 16 16'>
          <path d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16'/>
          <path d='m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0'/>
        </svg>
      </button>
      <div id='menu' class='dropdown'>
        <button type='button' data-toggle='dropdown' style='background-color: rgba(0, 0, 0, 0); border: none;'>  
          <svg xmlns='http://www.w3.org/2000/svg' width='20' height='20' fill='currentColor' class='bi bi-list' viewBox='0 0 16 16'>
            <path fill-rule='evenodd' d='M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5'/>
          </svg>
        </button>
        <div class='dropdown-menu dropdown-menu-right'>
          <h6 class='dropdown-header'>Cards from previous years</h6>
          <a class='dropdown-item' href='https://davidborland.github.io/ChristmasCard/2020/'>2020</a>
          <a class='dropdown-item' href='https://davidborland.github.io/ChristmasCard/2021/'>2021</a>
          <a class='dropdown-item' href='https://davidborland.github.io/ChristmasCard/2022/'>2022</a>
          <a class='dropdown-item' href='https://davidborland.github.io/ChristmasCard/2023/'>2023</a>
        </div>
      </div>
    </div>
  </div>
  <hr />
  <div id='theme' class="card">
    <div class="card-header text-center text-uppercase fw-bold">
      Today's theme
    </div>
    <div class="card-body fw-bolder fs-4">
      Our year...
    </div>
  </div>
  <div id='word-grid'></div>
  <div id='toolbar' class='button-toolbar mt-4'>    
    <div id='hint-button' class='button'>Hint</div>
  </div>
</div>

<div id='instructions' class='modal' tabindex='-1'> 
  <div class='modal-dialog'> 
    <div class='modal-content'> 
      <div class='modal-header'> 
        <h5 class='modal-title'> 
          How to play Winter Windings
        </h5> 
      </div> 
      <div class='modal-body'> 
        <p> 
          <strong>Find theme words related to our past year.</strong>
          <ul>
            <li>Theme words stay highlighted in blue when found.</li>
            <li>Drag or tap letters to create words. If tapping, double tap the last letter to submit.</li>
            <li>Theme words fill the board entirely. No theme words overlap.</li>
          </ul>          
        </p> 
        <p> 
          <strong>Find the "spangram."</strong>
          <ul>
            <li>The spangram describes the puzzle's theme and touches two opposite sides of the board. It may be two words.</li>
            <li>The spangram highlights in yellow when found.</li>
            <li>An example spangram with corresponding theme words: LIME, FRUIT, BANANA, APPLE, etc.</li>
          </ul>          
        </p> 
        <p> 
          <strong>Need a hint?</strong>
          <ul>
            <li>Find non-theme words to get hints.</li>
            <li>For every 3 non-theme words you find, you earn a hint.</li>
            <li>Hints show the letters of a theme word. If there is already an active hint on the board, a hint will show that wordâ€™s letter order.</li>
          </ul>          
        </p> 
        <hr />
        <p>
          A shameless rip off of <a href='https://www.nytimes.com/games/strands'>Strands</a> from the New York Times.
        </p>
      </div> 
    </div> 
  </div> 
</div> 

<script src='https://code.jquery.com/jquery-3.3.1.slim.min.js' integrity='sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo' crossorigin='anonymous'></script>
<script src='https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js' integrity='sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49' crossorigin='anonymous'></script>
<script src='https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js' integrity='sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy' crossorigin='anonymous'></script>

<script type='module'>
  import * as d3 from 'https://cdn.jsdelivr.net/npm/d3@7/+esm';

  const strandColor = '#679576';    // green
  const spangramColor = '#d78685';  // red
  const guessColor = '#bcc6cc';     // bluegrey

  // Utility functions
  const drawGrid = words => {
    d3.select('#word-grid').selectAll('.grid-cell')
      .data(letters)
      .join('div')
      .attr('class', 'grid-cell')
      .text(d => d.value)
  };

  d3.select('#theme').select('.card-header')
    .style('background-color', strandColor)

  const instructions = new bootstrap.Modal(document.getElementById('instructions'));
  d3.select('#instructions')
    .on('mousedown', () => instructions.hide());
  instructions.show();

  // Get data
  const [words, letters, numColumns] = await d3.json('grid.json').then(grid => {
    const words = [];
    const letters = [];

    grid.forEach((row, i) => {
      row.split(' ').forEach((s, j) => {
        // Get character and word info from string
        const [char, info] = s.split('-');
        const [id, pos] = info.split('');

        // Get the word
        let word = words.find(word => word.id === id);
        if (!word) {
          word = { 
            id: id,
            letters: []
          };

          words.push(word);
        }


        // Add the letter
        const letter = {
          value: char,
          word: word,
          pos: pos,
          i: i,
          j: j
        };

        letters.push(letter);        
        word.letters.push(letter);
      });
    });

    words.forEach(word => word.letters.sort((a, b) => d3.ascending(a.pos, b.pos)));

    const numColumns = d3.max(letters, letter => letter.j) + 1;

    return [words, letters, numColumns];
  });

  console.log(words);
  console.log(letters);
  console.log(numColumns);

  // Grid

  // XXX: Not sure how well a css grid will work with links. Might be better to use d3 ordinal scales?

  d3.select('#word-grid')
    .style('grid-template-columns', `repeat(${ numColumns }, 1fr`);

  drawGrid(words);

  // Buttons
  d3.select('#info-button')
    .on('mousedown', function () {
      instructions.show();
    });

  d3.select('#hint-button')
    .on('mousedown', function () {
      d3.select(this)
        .classed('down', true);

      // Show hint
    })
    .on('mouseup', function () {
      d3.select(this)
        .classed('down', false);
    });

</script>

</body>
</html>