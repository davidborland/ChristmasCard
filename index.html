<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Merry Christmas!</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

  <style>
    html, body {
      height: 100%;
    }

    .fullHeight {
      height: 100%;
    }

    svg {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>

<div class="container-fluid text-center fullHeight">
  <div class="row fullHeight">
    <div class="col-12 fullHeight">
      <svg id="card">
        <g></g>
      </svg>
    </div>
  </div>
</div>

<script type="text/javascript">

const imageSize = 200;
const numImages = 50;

// XXX: Create x and y in pixels, just have enough to handle large screens

d3.json("imageNames.json")
  .then(data => {
    images = d3.range(numImages).map((d, i) => ({
      href: "images/" + data[i % data.length],
      x: Math.random(),
      y: Math.random()
    }));

    setInterval(() => drawImages(images), 500);
  })
  .catch(error => {
    console.log(error);
  });

function drawImages(images) {
  const margin = imageSize;

  const svg = d3.select("#card");

  const width = parseInt(svg.style("width"), 10) - margin * 2;
  const height = parseInt(svg.style("height"), 10) - margin * 2;

  const g = svg.select("g")
      .attr("transform", "translate(" + (margin - imageSize / 2) + "," + (margin - imageSize / 2) + ")");

  const xScale = d3.scaleLinear()
      .domain([0, 1])
      .range([0, width]);

  const yScale = d3.scaleLinear()
      .domain([0, 1])
      .range([0, height]);

  g.selectAll("image")
    .data(images)
    .join(
      enter => enter.append("image")
          .attr("href", d => d.href)
          .attr("clip-path", "circle(50%)")
          .attr("width", imageSize)
          .attr("height", imageSize)
          .attr("x", d => xScale(d.x))
          .attr("y", d => yScale(d.y)),
      exit => exit.remove()
    )
      .attr("x", d => xScale(d.x))
      .attr("y", d => yScale(d.y));
}

</script>

</body>
</html>